# VEglue
This repository contains the source code for the paper VEglue: Testing Visual Entailment Systems via Object-Aligned Joint Erasing

# Overview
we propose VEglue, an object-aligned joint erasing approach for VE systems testing. It first aligns the object regions in the premise and object descriptions in the hypothesis to identify linked and un-linked objects. Then, based on the alignment information, three Metamorphic Relations are designed to jointly erase the objects of the two modalities.

The overview of VEglue is shown in the figure below:  
![Image text](https://github.com/lsplx/VEtesting/blob/master/data/artifacture_refine.png)

# Result
![Image text](https://github.com/lsplx/VEtesting/blob/master/data/VEglue_result.png)
![Image text](https://github.com/lsplx/VEtesting/blob/master/data/MR_result.png)

- extractentity_VE.py uses chatgpt to extract entities
- VG.py uses visual grounding model to locate the corresponding regions of semantic units
- MR.py used to generate test data for three MRs

# Environment
- pip install requirements.txt

# Running
```
python extractentity_VE.py 
```   
After running the extractentity_VE.py file, you will get snli_test_entity.xlsx   

```
python VG.py  
```
After running the VG.py file, you will get snli_ve_test_bbox_entailment.xlsx  

```
python MR.py  
```
In this line in the MR.py file, MR1 can be replaced with MR2 or MR3  
new_imagebase64_list,new_deletesentence_list = MR1(each,jpg_path,uniq_list[num])  
After running MR.py, you will get the test sets generated by MR1, MR2 and MR3.  
The generated test sets are in the following link  

# Link
- [Dataset for MRs](https://pan.baidu.com/s/1HLuZR1fvQW2Qj7ZXQ5xaww?pwd=pdos)
- [VE Models for two dataset](https://pan.baidu.com/s/1i1-lIF0IxSXAKbJv8gdtDg?pwd=5bfw)
- [Models for object detection](https://github.com/RistoranteRist/mmlab-weights/releases/download/dino-swinl/dino-5scale_swin-l_8xb2-36e_coco-5486e051.pth)






